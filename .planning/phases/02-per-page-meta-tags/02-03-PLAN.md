---
phase: 02-per-page-meta-tags
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - public/sitemap.xml
  - public/robots.txt
  - src/index.css
  - src/components/layout/RootLayout.tsx
autonomous: true

must_haves:
  truths:
    - "sitemap.xml uses https://10xvelocity.ai (no www) for all URLs"
    - "robots.txt Sitemap directive uses https://10xvelocity.ai (no www)"
    - "The n8n chat widget no longer renders an H1 element in the DOM"
    - "Each page has exactly one H1 tag"
  artifacts:
    - path: "public/sitemap.xml"
      provides: "Correct canonical domain in all URLs"
      contains: "https://10xvelocity.ai/"
    - path: "public/robots.txt"
      provides: "Correct sitemap URL"
      contains: "https://10xvelocity.ai/sitemap.xml"
    - path: "src/index.css"
      provides: "CSS fallback for chat widget H1 styling"
      contains: ".chat-layout .chat-header h1"
    - path: "src/components/layout/RootLayout.tsx"
      provides: "MutationObserver hook that replaces chat H1 with span"
      contains: "useChatWidgetH1Fix"
  key_links:
    - from: "src/components/layout/RootLayout.tsx"
      to: "n8n chat widget DOM"
      via: "MutationObserver watching document.body for .chat-layout .chat-header h1"
      pattern: "querySelector.*chat-header.*h1"
    - from: "public/sitemap.xml"
      to: "search engine crawlers"
      via: "canonical domain in loc elements"
      pattern: "https://10xvelocity\\.ai/"
---

<objective>
Fix two infrastructure issues: (1) correct the www -> non-www domain mismatch in sitemap.xml and robots.txt that was created in Phase 1, and (2) fix the duplicate H1 injected by the n8n chat widget on every page.

Purpose: The sitemap currently sends crawlers to www.10xvelocity.ai which 301-redirects to 10xvelocity.ai, wasting crawl budget and creating inconsistency with canonical tags. The chat widget's H1 violates the one-H1-per-page SEO best practice on every page.
Output: Corrected sitemap/robots files and a JS+CSS solution that eliminates the duplicate H1.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-per-page-meta-tags/02-RESEARCH.md
@public/sitemap.xml (needs www removal)
@public/robots.txt (needs www removal)
@src/index.css (CSS fallback for H1 fix)
@src/components/layout/RootLayout.tsx (H1 fix hook location)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix www -> non-www domain in sitemap.xml and robots.txt</name>
  <files>
    public/sitemap.xml
    public/robots.txt
  </files>
  <action>
    **sitemap.xml:** Replace ALL occurrences of `https://www.10xvelocity.ai` with `https://10xvelocity.ai` throughout the file. This is a global find-and-replace. There are 34 `<loc>` elements that all need updating. Do NOT change anything else (no priority, changefreq, or structure changes).

    **robots.txt:** Replace the Sitemap line from:
    `Sitemap: https://www.10xvelocity.ai/sitemap.xml`
    to:
    `Sitemap: https://10xvelocity.ai/sitemap.xml`

    WHY: The canonical domain is `10xvelocity.ai` (confirmed via 301 redirect from www). The Phase 2 canonical tags all use the non-www domain. The sitemap and robots.txt must match to avoid sending crawlers through a redirect chain.
  </action>
  <verify>
    Grep sitemap.xml for "www.10xvelocity" -- should return ZERO matches.
    Grep robots.txt for "www.10xvelocity" -- should return ZERO matches.
    Grep sitemap.xml for "https://10xvelocity.ai" -- should return 34 matches (one per URL).
    Run `npm run build` -- build must succeed.
  </verify>
  <done>All URLs in sitemap.xml and robots.txt use https://10xvelocity.ai (no www). Zero occurrences of www remain.</done>
</task>

<task type="auto">
  <name>Task 2: Fix duplicate H1 from n8n chat widget (CSS + JS MutationObserver)</name>
  <files>
    src/index.css
    src/components/layout/RootLayout.tsx
  </files>
  <action>
    **Two-pronged approach: CSS fallback + JS DOM replacement.**

    **1. CSS fallback in src/index.css:**
    Add the following at the END of the file (after all existing rules):

    ```css
    /* Fix duplicate H1 from n8n chat widget - demote to non-heading visual style */
    .chat-layout .chat-header h1 {
      font-size: inherit;
      font-weight: inherit;
      margin: 0;
      display: inline;
    }
    ```

    This is a visual fallback only. It does NOT remove the H1 from the DOM, but it prevents the widget title from visually appearing as a heading.

    **2. JS DOM replacement in RootLayout.tsx:**
    Create a custom hook `useChatWidgetH1Fix` in the same file (above the component) and call it from the RootLayout component. This hook uses a MutationObserver to watch for the chat widget being added to the DOM, then replaces its `<h1>` with a `<span>`.

    Implementation:

    ```typescript
    import { useEffect } from "react";

    const useChatWidgetH1Fix = () => {
      useEffect(() => {
        const fixChatH1 = (): boolean => {
          const chatH1 = document.querySelector('.chat-layout .chat-header h1');
          if (chatH1 && chatH1.parentNode) {
            const span = document.createElement('span');
            span.innerHTML = chatH1.innerHTML;
            span.className = chatH1.className;
            const style = chatH1.getAttribute('style');
            if (style) span.setAttribute('style', style);
            chatH1.parentNode.replaceChild(span, chatH1);
            return true;
          }
          return false;
        };

        // Try immediately in case widget already loaded
        if (fixChatH1()) return;

        // Watch for the widget to be added to the DOM
        const observer = new MutationObserver(() => {
          if (fixChatH1()) {
            observer.disconnect();
          }
        });

        observer.observe(document.body, { childList: true, subtree: true });

        return () => observer.disconnect();
      }, []);
    };
    ```

    Then inside the `RootLayout` component, add `useChatWidgetH1Fix();` as the first line of the function body, before the return statement.

    The final RootLayout.tsx should look like:
    ```typescript
    import { useEffect } from "react";
    import Header from "@/components/landing/Header";
    import Footer from "@/components/landing/Footer";
    import { Outlet } from "react-router-dom";

    const useChatWidgetH1Fix = () => {
      useEffect(() => {
        // ... hook implementation as above
      }, []);
    };

    const RootLayout = () => {
      useChatWidgetH1Fix();

      return (
        <div className="min-h-screen flex flex-col">
          <Header />
          <Outlet />
          <Footer />
        </div>
      );
    };

    export default RootLayout;
    ```

    IMPORTANT: The chat widget may use Shadow DOM, in which case the querySelector will not find the H1. This is a known limitation documented in the research. The CSS fallback handles the visual case. Post-deployment verification is needed to confirm the JS approach works on the live site. If the widget is NOT loaded in the dev environment (it is injected by the GPTEngineer script on production), the hook will simply observe and do nothing -- no errors, no side effects.

    IMPORTANT: Do NOT remove or modify the GPTEngineer script tag in index.html. The comment says "DO NOT REMOVE THIS SCRIPT TAG."
  </action>
  <verify>
    Run `npm run build` -- build must succeed.
    Verify src/index.css contains the `.chat-layout .chat-header h1` CSS rule.
    Verify RootLayout.tsx contains `useChatWidgetH1Fix` hook definition and invocation.
    Run `npm run dev` briefly and check browser console for no errors from the MutationObserver code.
  </verify>
  <done>CSS fallback rule added to index.css. MutationObserver hook in RootLayout.tsx watches for and replaces the chat widget H1 with a span. Build succeeds. No console errors in dev mode.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. sitemap.xml contains zero occurrences of "www.10xvelocity"
3. robots.txt Sitemap line points to `https://10xvelocity.ai/sitemap.xml`
4. src/index.css has CSS rule targeting `.chat-layout .chat-header h1`
5. RootLayout.tsx has `useChatWidgetH1Fix` hook that replaces H1 with span via MutationObserver
6. Dev server runs without console errors
</verification>

<success_criteria>
- Sitemap and robots.txt use correct non-www domain throughout
- CSS fallback prevents chat widget H1 from displaying as a heading
- JS MutationObserver replaces chat widget H1 element with span in the DOM
- Build succeeds, no runtime errors
- The H1 fix works silently when the chat widget is not present (dev environment)
</success_criteria>

<output>
After completion, create `.planning/phases/02-per-page-meta-tags/02-03-SUMMARY.md`
</output>
